# Docker Compose Override cho Development Testing
# Sử dụng mock backends để không cần external dependencies
#
# Usage:
#   docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
#
# Hoặc set COMPOSE_FILE environment variable:
#   export COMPOSE_FILE=docker-compose.yml:docker-compose.dev.yml
#   docker-compose up -d

version: "3.8"

services:
  # LLM Gateway với mock backend - không cần Ollama
  llm-gateway:
    build:
      context: ../../services/llm-gateway
      dockerfile: Dockerfile
    ports:
      - "8004:8000"
    environment:
      RAG_LLM_BACKEND: mock  # Sử dụng mock thay vì ollama
      RAG_MOCK_RESPONSE: "This is a mock response for testing purposes."
    # Không cần volumes hay depends_on

  # Rerank service - lightweight, luôn chạy
  rerank:
    build:
      context: ../../services/rerank
      dockerfile: Dockerfile
    ports:
      - "8005:8000"
    environment:
      RAG_MODEL: BAAI/bge-reranker-v2-m3
      RAG_DEVICE: cpu
    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 512M
